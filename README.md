# PVZ

## Описание 
Данный проект является backend-сервисом для сотрудников ПВЗ, который позволит вносить информацию по заказам в рамках приёмки товаров.

Сервер запускается на порту 8080, метрики можно получить на порту 9000, gRPC-метод доступен на 3000 порту.


## Инструкция по сборке
Для запуска сервера необходимо склонировать данный репозиторий и перейти в его директорию:
```
git clone https://github.com/Dmitrii-Dmitrii/pvz.git
cd pvz
```
Далее нужно перейти в директорию `/docker`. Внутри нее находится `docker-compose.yml`, который отвечает за развертывание базы данных. Его нужно запустить:
```
cd docker
docker-compose up -d
```
После важно создать `.env` файл **в корне проекта**:
```
touch .env
```
Пример `.env` файла:
```
JWT_SECRET="jwt_secret"
SERVER_PORT="8080"
PROMETHEUS_PORT="9000"
GRPC_PORT="3000"
CONNECTION_STRING="postgres://pvz_user:pvz_password@localhost:5432/pvz_database?sslmode=disable"
```
Далее необходимо запустить сервер:
```
go run cmd/server/main.go
```

## Дополнения к решению
- при вызове GET /pvz могут быть неправильные входные данные, поэтому решено возвращаться 400 ошибку;
- вероятность того, что на сервере произойдет внутренняя ошибка, крайне мала, но не равно 0, поэтому добавлена 500 ошибка;
- поскольку у одного ПВЗ может быть достаточно много приемок и товаров, а самих ПВЗ может быть мало, решено реализовать пагинацию для товаров;
- так как почти все endpoint'ы доступны только авторизованным пользователям с определенными ролями, добавлены 401 и 403 ошибки;
- также в проекте присутствуют интеграционные тесты драйверов;
- так как в openapi схеме для GET /pvz указано возвращать пвз, их приемки и товары, а в файле `pvz.proto` указан `message` только для ПВЗ, то в зависимости от запроса (`HTTP` или `gRPC`) будут возвращены разные результаты.

## Кодогенерация

В репозитории есть все необходимые сгенерированные файлы, но если вдруг появится необходимость сгенерировать что-либо, то нужно выполнить следующее:
- для кодогенерации DTO endpoint'ов по openapi схеме:
    - перейти в директорию `/swagger` 
    - выполнить `oapi-codegen -config codegen.yaml swagger.yaml`
- для генерации proto-файлов нужно запустить скрипт `/scripts/generate_proto.sh`